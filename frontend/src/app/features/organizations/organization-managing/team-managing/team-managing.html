<div class="max-w-4xl mx-auto">
  <button
    class="text-blue-500 hover:text-blue-700 mb-6 inline-flex items-center gap-1 transition-colors"
    (click)="goBack()"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    {{ 'common.back' | translate }}
  </button>

  @if (team()) {
    <h1 class="text-3xl font-semibold mb-8">{{ team()!.name }}</h1>

    @if (!showSelection()) {
      <!-- Team Members List -->
      <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
        <div class="px-5 py-3 bg-gray-50 border-b border-gray-200 flex items-center justify-between">
          <h2 class="text-lg font-medium text-gray-800">{{ 'teamManaging.members.title' | translate }}</h2>
          <button
            class="px-4 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"
            (click)="openSelection()"
          >
            {{ 'teamManaging.members.manage' | translate }}
          </button>
        </div>
        <div class="p-5">
          @if (teamMembers().length === 0) {
            <p class="text-gray-500 text-sm">{{ 'teamManaging.members.empty' | translate }}</p>
          } @else {
            <ul class="space-y-2">
              @for (member of teamMembers(); track member.id) {
                <li
                  role="button"
                  tabindex="0"
                  class="flex items-center gap-3 px-4 py-3 bg-white border border-gray-200 rounded-lg shadow-sm cursor-pointer hover:border-gray-300 hover:shadow-md transition-all"
                  (click)="openMemberReport(member)"
                  (keydown.enter)="openMemberReport(member)"
                >
                  <div class="h-9 w-9 rounded-full bg-teal-100 text-teal-600 flex items-center justify-center text-sm font-medium flex-shrink-0">
                    {{ member.firstName.charAt(0) }}{{ member.lastName.charAt(0) }}
                  </div>
                  <span class="text-gray-800 font-medium">{{ member.firstName }} {{ member.lastName }}</span>
                </li>
              }
            </ul>
          }
        </div>
      </div>
    } @else {
      <!-- Member Selection -->
      <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden">
        <div class="px-5 py-3 bg-gray-50 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-800">{{ 'teamManaging.selection.title' | translate }}</h2>
          <p class="text-sm text-gray-500 mt-1">{{ 'teamManaging.selection.description' | translate }}</p>
        </div>
        <div class="p-5">
          @if (selectionList().length === 0) {
            <p class="text-gray-500 text-sm">{{ 'teamManaging.members.noOrgMembers' | translate }}</p>
          } @else {
            <ul class="space-y-1">
              @for (member of selectionList(); track member.id) {
                <li
                  role="button"
                  tabindex="0"
                  class="flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition-all"
                  [class.bg-teal-50]="member.inTeam"
                  [class.border]="member.inTeam"
                  [class.border-teal-200]="member.inTeam"
                  [class.hover:bg-gray-50]="!member.inTeam"
                  [class.hover:bg-teal-100]="member.inTeam"
                  [class.opacity-50]="togglingId() === member.id"
                  (click)="toggleMember(member)"
                  (keydown.enter)="toggleMember(member)"
                >
                  <!-- Checkbox -->
                  <div
                    class="h-5 w-5 rounded border-2 flex items-center justify-center flex-shrink-0 transition-colors"
                    [class.border-teal-500]="member.inTeam"
                    [class.bg-teal-500]="member.inTeam"
                    [class.border-gray-300]="!member.inTeam"
                  >
                    @if (member.inTeam) {
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                      </svg>
                    }
                  </div>

                  <!-- Avatar -->
                  <div class="h-9 w-9 rounded-full flex items-center justify-center text-sm font-medium flex-shrink-0"
                    [class.bg-teal-100]="member.inTeam"
                    [class.text-teal-600]="member.inTeam"
                    [class.bg-gray-100]="!member.inTeam"
                    [class.text-gray-500]="!member.inTeam"
                  >
                    {{ member.firstName.charAt(0) }}{{ member.lastName.charAt(0) }}
                  </div>

                  <!-- Name -->
                  <span class="font-medium" [class.text-gray-800]="member.inTeam" [class.text-gray-600]="!member.inTeam">
                    {{ member.firstName }} {{ member.lastName }}
                  </span>

                  <!-- Loading spinner -->
                  @if (togglingId() === member.id) {
                    <svg class="animate-spin h-4 w-4 text-gray-400 ml-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                  }
                </li>
              }
            </ul>
          }
        </div>
      </div>
    }
  } @else {
    <p class="text-gray-500">{{ 'common.loading' | translate }}</p>
  }

  <div class="bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden mt-5">
    <div class="px-5 py-3 bg-gray-50 border-b border-gray-200 flex items-center justify-between">
      <h2 class="text-lg font-medium text-gray-800">{{ 'teamManaging.reports.title' | translate }}</h2>
    </div>
    <div class="p-5">
      <app-reports [organizationId]="organizationId" [members]="teamMembers()" />
    </div>
  </div>
</div>
